<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaign vs Deposit Analysis</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
        }

        .controls label {
            margin-right: 10px;
            font-weight: bold;
        }

        .controls select {
            margin-right: 20px;
            padding: 5px 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        #stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 5px;
        }

        #stats div {
            flex: 1;
        }

        #stats strong {
            display: block;
            color: #1976d2;
            font-size: 24px;
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px;
            border-radius: 5px;
            pointer-events: none;
            opacity: 0;
            font-size: 12px;
            z-index: 1000;
        }

        h1 {
            text-align: center;
            color: #333;
        }
    </style>
</head>

<body>
    <div class="container" style="margin-top: 40px;">
        <h3>Indivisual Assignment Submitted By: Usama 12535769</h3>Deployed at: https://usamagondal.github.io/Assignment_3_InfoViz/</div>
       
    <div class="container">
        <h1>Campaign vs Deposit (by Demographics)</h1>

        <div class="controls">
            <label>Job:</label>
            <select id="jobSelect">
                <option value="all">all</option>
            </select>

            <label>Education:</label>
            <select id="educationSelect">
                <option value="all">all</option>
            </select>

            <label>Marital:</label>
            <select id="maritalSelect">
                <option value="all">all</option>
            </select>
        </div>

        <div id="stats"></div>
        <div id="chart"></div>
    </div>

    <script>
        // Generate sample data
        function generateData() {
            const jobs = ['admin.', 'blue-collar', 'technician', 'services', 'management', 'retired', 'entrepreneur', 'self-employed', 'unemployed', 'student'];
            const maritalStatus = ['married', 'single', 'divorced'];
            const education = ['primary', 'secondary', 'tertiary', 'unknown'];

            const data = [];
            const numPoints = 600;

            for (let i = 0; i < numPoints; i++) {
                const campaign = Math.floor(Math.random() * 60) + 1;
                const job = jobs[Math.floor(Math.random() * jobs.length)];
                const marital = maritalStatus[Math.floor(Math.random() * maritalStatus.length)];
                const edu = education[Math.floor(Math.random() * education.length)];
                const age = Math.floor(Math.random() * 60) + 20;
                const duration = Math.floor(Math.random() * 3000);
                const previous = Math.floor(Math.random() * 5);

                // Calculate deposit probability
                let baseRate = 0.15;
                if (job === 'retired' || job === 'student') baseRate += 0.08;
                if (job === 'management') baseRate += 0.05;
                if (edu === 'tertiary') baseRate += 0.06;
                if (marital === 'single') baseRate += 0.03;

                const campaignPenalty = Math.min(campaign * 0.012, 0.20);
                const durationBonus = Math.min(duration / 10000, 0.08);

                const depositProb = Math.max(0, Math.min(1,
                    baseRate - campaignPenalty + durationBonus + (Math.random() * 0.15 - 0.075)
                ));

                const deposit = Math.random() < depositProb ? 'yes' : 'no';

                data.push({
                    campaign,
                    deposit,
                    job,
                    marital,
                    education: edu,
                    age,
                    duration,
                    previous
                });
            }

            return data;
        }

        // Populate dropdowns
        function populateDropdowns(data) {
            const jobs = ['all', ...new Set(data.map(d => d.job))];
            const education = ['all', ...new Set(data.map(d => d.education))];
            const marital = ['all', ...new Set(data.map(d => d.marital))];

            const jobSelect = d3.select('#jobSelect');
            jobSelect.selectAll('option').remove();
            jobSelect.selectAll('option')
                .data(jobs)
                .enter()
                .append('option')
                .attr('value', d => d)
                .text(d => d);

            const eduSelect = d3.select('#educationSelect');
            eduSelect.selectAll('option').remove();
            eduSelect.selectAll('option')
                .data(education)
                .enter()
                .append('option')
                .attr('value', d => d)
                .text(d => d);

            const maritalSelect = d3.select('#maritalSelect');
            maritalSelect.selectAll('option').remove();
            maritalSelect.selectAll('option')
                .data(marital)
                .enter()
                .append('option')
                .attr('value', d => d)
                .text(d => d);
        }

        // Draw chart
        function drawChart(data) {
            // Clear previous chart
            d3.select('#chart').selectAll('*').remove();

            // Get filter values
            const selectedJob = d3.select('#jobSelect').property('value');
            const selectedEducation = d3.select('#educationSelect').property('value');
            const selectedMarital = d3.select('#maritalSelect').property('value');

            // Filter data
            let filtered = data.filter(d =>
                (selectedJob === 'all' || d.job === selectedJob) &&
                (selectedEducation === 'all' || d.education === selectedEducation) &&
                (selectedMarital === 'all' || d.marital === selectedMarital)
            );

            // Set up dimensions
            const margin = { top: 60, right: 140, bottom: 80, left: 80 };
            const width = 1000 - margin.left - margin.right;
            const height = 600 - margin.top - margin.bottom;

            // Create SVG
            const svg = d3.select('#chart')
                .append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            // Create scales
            const xScale = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.campaign)])
                .range([0, width]);

            const yScale = d3.scalePoint()
                .domain(['no', 'yes'])
                .range([height, 0])
                .padding(0.5);

            const sizeScale = d3.scaleSqrt()
                .domain([0, d3.max(data, d => d.duration)])
                .range([2, 15]);

            const colorScale = d3.scaleOrdinal()
                .domain(['yes', 'no'])
                .range(['#27ae60', '#e74c3c']);

            // Add grid lines
            svg.append('g')
                .attr('class', 'grid')
                .selectAll('line')
                .data(xScale.ticks(10))
                .enter()
                .append('line')
                .attr('x1', d => xScale(d))
                .attr('x2', d => xScale(d))
                .attr('y1', 0)
                .attr('y2', height)
                .attr('stroke', '#e0e0e0')
                .attr('stroke-width', 1);

            // Add X axis
            svg.append('g')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(xScale).ticks(10))
                .selectAll('text')
                .style('font-size', '12px');

            svg.append('text')
                .attr('x', width / 2)
                .attr('y', height + 45)
                .attr('text-anchor', 'middle')
                .style('font-size', '14px')
                .style('font-weight', 'bold')
                .text('Campaign Contacts');

            // Add Y axis
            svg.append('g')
                .call(d3.axisLeft(yScale))
                .selectAll('text')
                .style('font-size', '14px')
                .style('font-weight', 'bold');

            svg.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -height / 2)
                .attr('y', -50)
                .attr('text-anchor', 'middle')
                .style('font-size', '14px')
                .style('font-weight', 'bold')
                .text('Deposit');

            // Create tooltip
            const tooltip = d3.select('body')
                .append('div')
                .attr('class', 'tooltip');

            // Add jitter
            const jitterStrength = 30;

            // Add scatter points
            svg.selectAll('circle')
                .data(filtered)
                .enter()
                .append('circle')
                .attr('cx', d => xScale(d.campaign) + (Math.random() - 0.5) * 10)
                .attr('cy', d => yScale(d.deposit) + (Math.random() - 0.5) * jitterStrength)
                .attr('r', d => sizeScale(d.duration))
                .attr('fill', d => colorScale(d.deposit))
                .attr('opacity', 0.6)
                .attr('stroke', '#333')
                .attr('stroke-width', 0.5)
                .on('mouseover', function (event, d) {
                    d3.select(this)
                        .attr('opacity', 1)
                        .attr('stroke-width', 2);

                    tooltip
                        .style('opacity', 1)
                        .html(`
                            <strong>Campaign:</strong> ${d.campaign}<br/>
                            <strong>Deposit:</strong> ${d.deposit}<br/>
                            <strong>Duration:</strong> ${Math.floor(d.duration)}s<br/>
                            <strong>Job:</strong> ${d.job}<br/>
                            <strong>Education:</strong> ${d.education}<br/>
                            <strong>Marital:</strong> ${d.marital}<br/>
                            <strong>Age:</strong> ${d.age}<br/>
                            <strong>Previous:</strong> ${d.previous}
                        `)
                        .style('left', (event.pageX + 10) + 'px')
                        .style('top', (event.pageY - 10) + 'px');
                })
                .on('mouseout', function () {
                    d3.select(this)
                        .attr('opacity', 0.6)
                        .attr('stroke-width', 0.5);

                    tooltip.style('opacity', 0);
                });

            // Add trend lines
            ['yes', 'no'].forEach(outcome => {
                const outcomeData = filtered.filter(d => d.deposit === outcome);

                const buckets = d3.rollup(
                    outcomeData,
                    v => d3.mean(v, d => d.campaign),
                    d => Math.floor(d.campaign / 5) * 5
                );

                const trendData = Array.from(buckets)
                    .map(([bucket]) => ({
                        campaign: bucket,
                        outcome: outcome
                    }))
                    .sort((a, b) => a.campaign - b.campaign);

                if (trendData.length > 1) {
                    const line = d3.line()
                        .x(d => xScale(d.campaign))
                        .y(yScale(outcome))
                        .curve(d3.curveBasis);

                    svg.append('path')
                        .datum(trendData)
                        .attr('fill', 'none')
                        .attr('stroke', colorScale(outcome))
                        .attr('stroke-width', 3)
                        .attr('stroke-dasharray', '5,5')
                        .attr('opacity', 0.7)
                        .attr('d', line);
                }
            });

            // Add legend
            const legend = svg.append('g')
                .attr('transform', `translate(${width + 20}, 0)`);

            legend.append('text')
                .attr('x', 0)
                .attr('y', 0)
                .style('font-weight', 'bold')
                .style('font-size', '12px')
                .text('Legend');

            legend.append('circle')
                .attr('cx', 10)
                .attr('cy', 25)
                .attr('r', 6)
                .attr('fill', '#27ae60');

            legend.append('text')
                .attr('x', 20)
                .attr('y', 30)
                .style('font-size', '11px')
                .text('Deposit: Yes');

            legend.append('circle')
                .attr('cx', 10)
                .attr('cy', 50)
                .attr('r', 6)
                .attr('fill', '#e74c3c');

            legend.append('text')
                .attr('x', 20)
                .attr('y', 55)
                .style('font-size', '11px')
                .text('Deposit: No');

            legend.append('text')
                .attr('x', 0)
                .attr('y', 85)
                .style('font-weight', 'bold')
                .style('font-size', '11px')
                .text('Circle Size:');

            legend.append('text')
                .attr('x', 0)
                .attr('y', 100)
                .style('font-size', '10px')
                .text('Call Duration');

            // Add title
            svg.append('text')
                .attr('x', width / 2)
                .attr('y', -35)
                .attr('text-anchor', 'middle')
                .style('font-size', '18px')
                .style('font-weight', 'bold')
                .text('Campaign Contacts vs Deposit Outcome');

            svg.append('text')
                .attr('x', width / 2)
                .attr('y', -15)
                .attr('text-anchor', 'middle')
                .style('font-size', '12px')
                .style('fill', '#666')
                .text('Hover over points for details');

            // Update statistics
            const yesDeposits = filtered.filter(d => d.deposit === 'yes');
            const successRate = (yesDeposits.length / filtered.length * 100).toFixed(1);
            const avgCampaignYes = d3.mean(yesDeposits, d => d.campaign).toFixed(1);
            const avgCampaignNo = d3.mean(filtered.filter(d => d.deposit === 'no'), d => d.campaign).toFixed(1);

            d3.select('#stats').html(`
                <div><small>Total Contacts</small><br/><strong>${filtered.length}</strong></div>
                <div><small>Success Rate</small><br/><strong>${successRate}%</strong></div>
                <div><small>Avg Campaign (Yes)</small><br/><strong>${avgCampaignYes}</strong></div>
                <div><small>Avg Campaign (No)</small><br/><strong>${avgCampaignNo}</strong></div>
            `);
        }

        // Initialize
        const data = generateData();
        populateDropdowns(data);
        drawChart(data);

        // Add event listeners
        d3.select('#jobSelect').on('change', () => drawChart(data));
        d3.select('#educationSelect').on('change', () => drawChart(data));
        d3.select('#maritalSelect').on('change', () => drawChart(data));
    </script>
    <div class="container" style="margin-top: 40px;">
        <h2>Explanation of the Assignment</h2>

        <h3>1. What are the data variables?</h3>
        <p>
            The dataset includes campaign contacts, deposit outcome, job type, marital status,
            education level, age, call duration, and previous contacts.
        </p>

        <h3>2. What type of visualization is it?</h3>
        <p>
            It is a jittered scatter plot (bubble chart) exploring the relationship between number
            of campaign contacts and whether a client made a deposit.
        </p>

        <h3>3. What visual encoding does it use?</h3>
        <p>
            X-position encodes campaign count, Y-position encodes deposit result, size encodes call
            duration, and color indicates deposit yes/no.
        </p>

        <h3>4. What are the visual elements?</h3>
        <p>
            Marks: circles; Scales: linear, point, sqrt, ordinal; Channels: position, size, color;
            Other: jitter, tooltips, axes, legend.
        </p>

        <h3>Description Paragraph</h3>
        <p>
            This visualization presents a jittered scatter plot showing how campaign contact frequency
            relates to deposit outcomes. Each circle represents a client, positioned by contacts and
            deposit outcome, sized by call duration, and colored by deposit status. Users can filter
            results by job, education, and marital status. Trend lines and tooltips enhance analysis,
            making patterns easier to interpret.
        </p>
    </div>
</body>

</html>